////////////////////////////////////////////////////
// Detect the selected theme
//

$modern-theme:         "body:not([id='body'])";
$light-modern-theme:   "body:not([id='body']):not(.dark-mode)";
$dark-modern-theme:    "body:not([id='body']).dark-mode";
// No (simple) was to tell classic from professional
$classic-or-professional-theme: "body[id='body']";

////////////////////////////////////////////////////
// Theme colors
//

// With the two modern themes, we use colors that
// are taken from other parts of the interface.
// For the classic/professional theme, we just
// use neutral grey colors (because we can't tell
// professional and classic apart, making it
// challenging to pick one color scheme for
// both places).

// Light modern
$color-light-sidebar-bg: rgb(247, 247, 247);
$color-light-sidebar-header-bg: #e6e6e6;
// color of the new comment notification box, as well as the 
// prev/next post box.
$color-light-new-comment-bg: rgb(238, 238, 238);
$color-light-link: rgba(0, 91, 149, 1);
$color-light-link-hover: rgb(118, 174, 209);

// Dark modern
$color-dark-sidebar-bg: rgb(4, 82, 134);
$color-dark-sidebar-header-bg: rgb(3, 61, 99);
// green accent color
$color-dark-accent: rgb(156, 199, 84);
// color of, e.g., "Posting as" or "comment"
$color-dark-deemphasized-text: rgb(204, 204, 204);


// Classic/professional
//
// Because we can't tell if we're on a dark or a light background, use
// some semitransparent gray colors.

// A darker background color
$color-classic-or-professional-deemphasized-bg: rgba(221, 221, 221, 0.2);
$color-classic-or-professional-deemphasized-bg-hover: rgba(187, 187, 187, 0.7);
// A lighter background color
$color-classic-or-professional-emphasized-bg: rgba(221, 221, 221, 0.5);
$color-classic-or-professional-emphasized-bg-hover: rgba(187, 187, 187, 0.7);


////////////////////////////////////////////////////
// Toolbar
//

$toolbar-item-padding-lr: 12px;
@mixin toolbar-item {
  padding-top: 12px;
  padding-bottom: 8px;

  padding-left: $toolbar-item-padding-lr;
  padding-right: $toolbar-item-padding-lr;
}

.md4mefi-toolbar {
	display: flex;
	flex-direction: row;
	justify-content: flex-end;

  // Want more space between this toolbox and the preview,
  // especially since they're so close in color in dark mode.
  margin-bottom: 10px;

  line-height: 1;

  #{$modern-theme} & {
	 font-size: 15px;
  }
}

.md4mefi-title {
  @include toolbar-item;

  #{$modern-theme} & {
    font-size: 15px;
  }
  #{$dark-modern-theme} & {
    color: $color-dark-deemphasized-text;
  }

  #{$classic-or-professional-theme} & {
    // Inherit the default text color
    background-color: $color-classic-or-professional-deemphasized-bg;
  }
}


.md4mefi-show-html  {
  // Make it align left
  flex: 2;

  font-weight: normal !important;
}


////////////////////////////////////////////////////
// Toolbar > Buttons
//

.md4mefi-buttonbar {
	display: flex;
	flex-direction: row;
	justify-content: flex-end;
}

.md4mefi-button {
  @include toolbar-item;
  cursor: pointer;
  
  display: flex;
  justify-content: baseline;
  
  &.md4mefi-bold {
    // Positioning the starts with translateX() puts them
    // a bit too close to the edge. Add some breating
    // room.
    padding-left: $toolbar-item-padding-lr + 3px;
    padding-right: $toolbar-item-padding-lr + 3px;
  }

  #{$dark-modern-theme} & {
    background-color: $color-dark-sidebar-bg;

    &:hover {
      background-color: mix($color-dark-sidebar-bg, #fff, 90%);
    }
  }
  #{$light-modern-theme} & {
    background-color: $color-light-new-comment-bg;
    &:hover {
      background-color: $color-light-sidebar-bg;
    }
  }

  #{$classic-or-professional-theme} & {
    //background-color: rgba(221, 221, 221, 0.3);
    background-color: $color-classic-or-professional-emphasized-bg;
    &:hover {
      //background-color: rgba(187, 187, 187, 0.7);
      background-color: $color-classic-or-professional-emphasized-bg-hover;
    }
  }
}

////////////////////////////////////////////////////
// Toolbar > Buttons > Text
//

.md4mefi-bold .md4mefi-button-text {
  font-weight: bold;
}

.md4mefi-italic .md4mefi-button-text {
  font-style: italic;

  #{$modern-theme} & {
    // Make the italics look better
    letter-spacing: 0.027em; // 4px
  }
}

.md4mefi-button-text {
  #{$dark-modern-theme} & {
    color: #fff;
  }
  #{$dark-modern-theme} .md4mefi-button:hover & {
    color: $color-dark-accent;
  }

  #{$light-modern-theme} & {
    // TODO: What color is this from? Make a variable,
    // for documentation.
    color: rgb(60, 90, 143);
  }
  #{$light-modern-theme} .md4mefi-button:hover & {
    color: $color-light-link-hover;
  }

  #{$classic-or-professional-theme} & {
    //color: #333333;
  }
  #{$classic-or-professional-theme} .md4mefi-button:hover & {
    //color: #111111;
  }
}

////////////////////////////////////////////////////
// Toolbar > Buttons > Prefix & Suffix
//

.md4mefi-bold, .md4mefi-italic {
  // Make the stars larger.
  // Use CSS transform, as opposed to larger text,
  // to avoid making the line height larger.
  $transform-scale: 1.5;
  $transform-translate-y: 0.200em;
  $transform-translate-x: 0.133em;

  .md4mefi-button-prefix {
    transform: scale($transform-scale)
               translateY($transform-translate-y)
               translateX(-1 * $transform-translate-x);
  }

  .md4mefi-button-suffix {
    transform: scale($transform-scale)
               translateY($transform-translate-y)
               translateX($transform-translate-x);
  }
}

.md4mefi-button-prefix { 
  padding-right: 2px; 
  
  .md4mefi-italic & {
    padding-right: 0px;
  }
}
.md4mefi-button-suffix { 
  padding-left: 2px;
  
  .md4mefi-italic & {
    padding-left: 0px;
  }
}

.md4mefi-button-prefix, .md4mefi-button-suffix {
  #{$dark-modern-theme} & {
    color: #ddd;
  }
  #{$dark-modern-theme} .md4mefi-button:hover & {
    // On hover, don't highlight the prefix/suffix.
    // Just highlight the text.

    //color: $color-dark-accent;
  }

  #{$light-modern-theme} & {
    color: #888;
  }
  #{$light-modern-theme} .md4mefi-button:hover & {
    color: #AAA;
  }

  #{$classic-or-professional-theme} & {
    opacity: 0.9;
  }
  #{$classic-or-professional-theme} .md4mefi-button:hover & {
    opacity: 0.5;
  }
} 


////////////////////////////////////////////////////
// MeFi Toolbar 
//
// See also: inject.js:addMessageToMeFiToolbar()
// Some CSS properties are set dynamically there.

.md4mefi-mefi-toolbar-wrapper {
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
}

.md4mefi-mefi-toolbar-message {
  margin-right: 0.75em;

  // .smallcopy (a CSS class from MeFi) gives lots of good stuff,
  // but also messes with margins and padding. Do not want.
  &.smallcopy {
    margin-top: 0 !important;
    padding-bottom: 0 !important;
  }
}


////////////////////////////////////////////////////
// Error message
//

.md4mefi-error {
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  // force title & close button to have same height
  align-items: stretch;

  margin: 1em 0;

  // Classic theme doesn't set this automatically, and not having
  // it messes up the flexbox sizing.
  box-sizing: border-box;
  > * { 
    box-sizing: border-box;
  }
}


.md4mefi-error-title {
  flex: 1 1 auto;

  padding: 0.5em 0.5em;
  font-weight: bold;

  #{$light-modern-theme} & {
    background-color: $color-light-sidebar-header-bg;
  }  
  #{$dark-modern-theme} & {
    background-color: $color-dark-sidebar-header-bg;
  }
  #{$classic-or-professional-theme} & {
    // @@@ TBD. For now, fuck it. Too many background colors.
    //border-bottom: 1px solid #666;
    background-color: $color-classic-or-professional-emphasized-bg;
  }  
}

.md4mefi-error-close {
  flex: 0 0 auto;

  min-width: 2em;

  // Vertical & horizontal centering
  display: flex;
  justify-content: center;
  align-items: center;

  cursor: pointer;
  font-weight: bold;

  #{$light-modern-theme} & {
    background-color: $color-light-sidebar-header-bg;
    &:hover {
      background-color: mix($color-light-sidebar-header-bg, #333, 90%);
    }          
  }  
  #{$dark-modern-theme} & {
    background-color: $color-dark-sidebar-header-bg;
    &:hover {
      background-color: mix($color-dark-sidebar-header-bg, #fff, 90%);
    }       
  }
  #{$classic-or-professional-theme} & {
    // @@@ TBD. For now, fuck it. Too many background colors.
    // border: 1px solid #666;
    // border-top-style: none;
    // border-right-style: none;


    background-color: $color-classic-or-professional-emphasized-bg;    
    &:hover {
      background-color: $color-classic-or-professional-emphasized-bg-hover;
    }
  }  
}

.md4mefi-error-message {
  flex: 0 0 100%;

  padding: 0.5em 0.5em;


  #{$light-modern-theme} & {
    background-color: $color-light-sidebar-bg;     
  }  
  #{$dark-modern-theme} & {
    background-color: $color-dark-sidebar-bg;
  }
  #{$classic-or-professional-theme} & {
    // @@@ TBD. For now, fuck it. Too many background colors.
    //border: 1px solid #666;

    background-color: $color-classic-or-professional-deemphasized-bg;
  }
}